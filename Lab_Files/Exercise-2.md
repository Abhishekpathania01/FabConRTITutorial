# Build A Fabric Real-Time Intelligence Solution in a Day 
## Exercise - 02
## Estimated duration: 2 hours
## Lab objectives: 
In this lab, you will be able to complete the following tasks:

- Task 1: Create a new Eventstream.
- Task 2: Import Data Generator Notebook.
- Task 3: Run the notebook.
- Task 4: Define Eventstream topology.

### Task 1: Create a new Eventstream
In this task, you will be streaming events (impressions and clicks events) generated by a notebook. The events will be streamed into an eventstream and consumed by our Eventhouse KQL Database.

1. Select your Workspace in the left pane, then click on **+ New Item**. In the popout window scroll a little bit down and select **Eventstream**.

    ![](media/image_task05_step01.png)

1. Give the Eventstream the name **WebEventsStream_ES**. Make sure that the checkbox **Enhanced Capabilites** is selected and click on **Create**.

    ![](media/image_task05_step02.png)

1. On the Screen **Design a flow to ingest, transform, and route streaming events** click on Use **Custom Endpoint**. This will create an event hub connected to the Eventstream.

    ![](media/image_task05_step03.png)

1. Insert `WebEventsCustomSource` as the source name and the click on Add.

    ![](media/image_task05_step04.png)

1. Click on **Publish** and now the Eventstream will be published and the Event Hub will be created.

    ![](media/image_task05_step05.png)

1. To get the information we need for the Notebook, the name of the event hub and a connection string click on the Eventstream source named **WebEventsCustomSource**. In the area below the diagram click on **Keys**. Then click on the copy icon besides the **Event hub name**. Now the event hub name is copied to the clipborad.

    ![](media/image_task05_step06.png)

1. To copy the connection string you first have to click on the view icon. After the connection string is revealed click on the copy icon and copy the connection string to Notepad as well.

    ![](media/image_task05_step07.png)

    >**Note:** To copy the connection string it must be visible.

### Task 2: Import Data Generator Notebook
We use a python notebook to generate a stream of artificial click events. The notebook can be found in **C:\LabFiles** directory.

1. Navigate back to your workspace that you have created.

1. Click on **Import** and select **Notebook** and click on **From this computer**

    ![](media/image_task06_step01.png)

1. In the pane **Import status** on the right side select **Upload**.

    ![](media/image_task06_step02.png)

1. Browse to the **C:\LabFiles** folder and select the `Generate_synthetic_web_events` notebook and click on the button **Open**.

    ![](media/image_task06_step03.png)

1. After the notebook has been uploaded Fabric will display a message that the notebook has been imported successfully.

### Task 3: Run the notebook
Now we have to run the notebook to create the stream of artificial click events for our lab. In order for the Notebook to send the events to the correct Event Hub we have to insert the information we have saved in Task 5 - Create Event Stream.To run the notebook and create our datastream please proceed with the following steps.

DO NOT use an InPrivate browser window. Recommend using a Personal browser window for the Notebook session to connect and run successfully.

1. Click on the Notebook **Generate_synthetic_web_events** in your Fabric Workspace to open it.

    ![](media/image_task07_step01.png)

1. Paste in the values your copied in **Task 7 - Create Event Stream** as values for "" and `eventHubConnString` into the `notebook`.

    ![](media/image_task07_step02.png)

1. Select the **Workspace default** as the **Environment** settings.

    ![](media/image_task07_step02b.png)

1. Click **Run all** at the top left to start generating streaming events.

    ![](media/image_task07_step03.png)

    >**Note:** Errors in Cell 1 may occur due to pre-installed libraries in the environment. These can be safely ignored, as they will not impact the successful execution of the notebook.

    ![](media/image_task07_errors.png)
    >**Note:** Wait a few minutes for the first code cell to finish and it will proceed to next code cells automatically.

1. Scroll to the last code cell, where the generated synthetic events should begin printing in JSON format. If the output matches the provided screenshot, the notebook is successfully streaming artificial click data to the Event Hub.Let the last query run in the background, we will proceed to the next task.
    ![](media/image_task07_step04.png)

### Task 4: Define Eventstream topology
In the , you will create the Eventstream topology that will insert the streamed data into your KQL database.

1. Open your Eventstream in your Fabric Workspace by clicking on your workspace icon in the left pane, and then navigating to **Eventstream WebEventStream_ES**.

    ![](media/image_08_step01.png)

1. Click on **Edit** in the top toolbar.

    ![](media/image_08_step02.png)

1. Click on the node **Transform events or add Destination** and select **Filter** from the menu.

    ![](media/image_08_step03.png)

    >**Note**: Check the table at the bottom of the screen to view events streamed by the notebook to the Eventstream.

1. Click on the pencil icon in the node **Filter** to enter edit mode.

    ![](media/image_task08_step04.png)

1. Provide the following values in the pane Filter on the left side. Then click on **Save**.

    | Field                  | Value          |
    |------------------------|----------------|
    | Operation name         | ClickEventsFilter |
    | Select a field to filter on | eventType    |
    | Keep events when the value | equals      |
    | value                  | CLICK          |

    ![](media/image_task08_step05.png)
    > **Note:** CLICK is in ALL CAPS.

1. The **ClickEventsFilter** node showing an **error** is expected. This indicates that there is no target for the outgoing data stream, which will be resolved in the next step.

1. Click on **+ (1)** icon next to the **ClickEventsFilter** node. and choose **Stream** from the context menu.

    ![](media/image_task08_step06.png)

1. Choose **Stream** from the context menu.

    ![](media/image_task08_step07.png)

1. Click on the pencil in node **Stream** to go to edit mode. Enter `ClickEventsStream` as name of the Eventstream in the field **Stream name**. Ensure that the **Input data format** is **Json**. Click on the Button **Save**.

    ![](media/image_task08_step08.png)

1. Click on **+** icon next to the node **ClickEventsStream**and select the option **Eventhouse** in the context menu.

    ![](media/image_task08_step10.png)

1. Click the pencil in node **Eventhouse** to enter edit mode. Provide the following values in the pane **Eventhouse** and click the button **Save** after you entered all the values.

    | Field                           | Value                                                                                                 |
    |----------------------------------|-------------------------------------------------------------------------------------------------------|
    | Event processing before ingestion| Ensure that this option is selected.                                                                  |
    | Destination name                | ClickEventStore                                                                                       |
    | Workspace                       | Select **RTI_<inject key="DeploymentID" enableCopy="false"></inject>**                                  |
    | Eventhouse                       | Select the Eventhouse WebEvents_EH                                                                     |
    | KQL Database                    | Select the KQL Database WebEvents_EH                                                                   |
    | Destination table               | Click on Create new and enter BronzeClicks as name for the new table and click on Done.               |
    | Input data format               | Ensure that the option Json is selected.                                                              |

    ![](media/image_task08_step11.png)

    ![](media/image_task08_step11b.png)

1. Click on the highlighted sign next to the node **WebEventsStream_ES** in the image below.

    ![](media/image_task08_step12.png)

1. Choose the option **Filter** from the context menu.

    ![](media/image_task08_step13.png)

1. Delete the connection between the new filter node **Filter** and the node **ClickEventsFilter** by clicking on the trashcan icon.

    ![](media/image_task08_step14.png)

1. Connect the output of the node **WebEventsStream_ES** to the input of the node **ClickEventsFilter**.

    ![](media/image_task08_step15.gif)

1. Click on the pencil icon of the new node **Filter** to enter edit mode. Provide the following values in the pane **Filter** on the left side. Then click on **Save**.

    | Field                  | Value            |
    |------------------------|------------------|
    | Operation name         | ImpressionEventsFilter |
    | Select a field to filter on | eventType      |
    | Keep events when the value | equals        |
    | value                  | IMPRESSION       |

    ![](media/image_task08_step16.png)

    > **Note:** IMPRESSION is in ALL CAPS.

1. The **ImpressionEventsFilter** node showing an **error** is expected. This indicates that there is no target for the outgoing data stream, which will be resolved in the next step.

1. Click on **+** sign next to the **ImpressionEventsFilter** node and choose **Stream** from the context menu.

    ![](media/image_task08_step17.png)

1. Click on the pencil icon in the node **Stream** to enter edit mode. Enter `ImpressionsEventsStream` as name of the Eventstream in the field **Stream name**. Ensure that the **Input** data format is **Json**. Click on the Button **Save**.

    ![](media/image_task08_step18.png)

1. Click on + icon next to the node **ImpressionEventsStream** and select **Eventhouse** from the context menu.

    ![](media/image_task08_step19.png)

1. Click the pencil in node **Eventhouse** to enter edit mode. Provide the following values in the pane **Eventhouse**, after providing these values click on the button **Save**.

    | Field                           | Value                                                                                                 |
    |----------------------------------|-------------------------------------------------------------------------------------------------------|
    | Event processing before ingestion| Ensure that this option is selected.                                                                  |
    | Destination name                | ImpressionEventStore                                                                                  |
    | Workspace                       | Select **RTI_<inject key="DeploymentID" enableCopy="false"></inject>**      |
    | Eventhouse                       | Select the Eventhouse WebEvents_EH                                                                     |
    | KQL Database                    | Select the KQL Database WebEvents_EH                                                                   |
    | Destination table               | Click on Create new and enter BronzeImpressions as name for the new table and click on Done.           |
    | Input data format               | Ensure that the option Json is selected.                                                              |

    ![](media/image_task08_step20.png)

1. Click on the button **Publish** that is located in the toolbar at the top of the screen.

    ![](media/image_task08_step21.png)

1. After a few minutes, you should see the nodes **ClickEventStore** and **ImpressionEventStore** change to mode **Active**.

    ![](media/image_task08_step21b.png)

1. At the end your Eventstream toplogy should look like the image below.

    ![](media/image_task08_step21c.png)

## Summary

In this lab, you worked on 

### You have successfully completed the Exercise